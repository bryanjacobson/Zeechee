<!-- Copyright 2012 Bryan Lee Jacobson -->
<div class="grid_12">
  <% if notice %>
    <p id="notice"><%= notice %></p>
  <% end %>

  <p>
    <b>Back to Topic:</b>
    <%= link_to @screen.topic.title, navigate_path(@screen.topic_id) %>
    <br />
    <span class="smedium_text">
      <%= link_to('Previous Screen', @screen.previous_screen) if @screen.previous_screen %>
      <%= @screen.title %>
    </span>
    [<%= link_to @screen.user.name, @screen.user %>]
    <%= link_to 'Edit', edit_screen_path(@screen) %> |
    <%= link_to 'Clone', clone_screen_path(@screen), :confirm => 'Clone screen and all contents?' %> |
    <%= link_to 'Create Screen', new_screen_path(:topic_id => @screen.topic_id) %>

  </p>

  <table>
  <% @screen.items.each do |item| %>
    <tr>
      <td>
      <div title="move up">
        <% if item.position > 1 %>
          <%= link_to(image_tag('up.png'), up_item_path(item)) %>
	<% else %>
          <%= image_tag('up_gray.png') %>
	<% end %>
      </div>
      <div style="float:left;" title="move down">
        <% if item.lower_item %>
          <%= link_to(image_tag('down.png'), down_item_path(item)) %>
        <% else %>
	  <%= image_tag('down_gray.png') %>
	<% end %>
      </div>
      </td>
      <td>
          <div title="Edit" style="padding-right:10px;">
            <%= link_to 'E', edit_item_path(item) %><br />
          </div>
      </td>
      <td>
        <% if item.item_type_id == 3 %>
	  <span
            <% if item.style && !item.style.blank? %>
              style="<%= item.style %>"
            <% else %>
              style="padding:5px;"
            <% end %>
            <% if item.note && !item.note.blank? %>
              title="<%= item.note %>"
            <% end %>
          >
	  <%= image_tag(item.body, :width => (item.size && !item.size.blank?) ? item.size : '200') %>
	  </span>
	<% elsif item.item_type_id == 4 %>
	  <span
            <% if item.style && !item.style.blank? %>
              style="<%= item.style %>"
            <% else %>
              style="padding:5px;"
            <% end %>
            <% if item.note && !item.note.blank? %>
              title="<%= item.note %>"
            <% end %>
          >
	  <% link = item.body %>
	  <% if !(link =~ /^http/) %>
	  <%   link = "http://" + link %>
	  <% end %>
	  <%= link_to item.body, link, :target => "_blank" %>
	  </span>
	<% elsif item.item_type_id == 5 %>
	  <% link = item.body %>
	  <% if !(link =~ /^http/) %>
	  <%   link = "http://" + link %>
	  <% end %>
	  <% link = link.sub("watch?v=","embed/") %>
	  <iframe width="560" height="315" src="<%= link %>" frameborder="0" allowfullscreen></iframe>
	<% else %>
	  <!-- Used for item_type_id==1 Text, and all others  -->
          <div
            <% if item.style && !item.style.blank? %>
              style="<%= item.style %>"
            <% else %>
              style="color:Navy;font-size:22px;"
            <% end %>
            <% if item.note && !item.note.blank? %>
              title="<%= item.note %>"
            <% end %>
          >
            <%= item.body %>
          </div>
        <% end %>
      </td>
    </tr>
  <% end %>
  </table>
  <br />

  <%= form_for(@item) do |f| %>
    <% if @item.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@item.errors.count, "error") %> prohibited this item from being saved:</h2>

        <ul>
        <% @item.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
        </ul>
      </div>
    <% end %>

    <%= f.hidden_field :screen_id %>
    <%= f.hidden_field :user_id %>
    <%= f.hidden_field :position %>

    <div class="field">
      <%= f.text_area :body, :rows => 2, :cols => 70 %><br />
      <%= f.label :type %>:
      <%= f.select :item_type_id, @item.item_types %>
      <%= f.label :style %>:
      <%= f.text_field :style, :size => 58 %><br />
      <%= f.label :note %>:
      <%= f.text_field :note, :size => 60 %>
      <%= f.label :size %>:
      <%= f.text_field :size, :size => 9 %>
    </div>

    <div class="actions">
      <%= f.submit %>
    </div>
  <% end %>
  
</div>
<div class="grid_4">
  <%= render 'fancy_button', :link => @screen.next_screen, :text => 'Next Screen' %>
  <br />
  <b>Comments:</b><br />

  <%= form_for(@comment) do |f| %>
    <% if @comment.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(@comment.errors.count, "error") %> prohibited this comment from being saved:</h2>
  
        <ul>
        <% @comment.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
        </ul>
      </div>
    <% end %>
  
    <%= f.hidden_field :commentable_id %>
    <%= f.hidden_field :commentable_type %>
    <%= f.hidden_field :user_id %>
  
    <div class="field">
      <%= f.text_area :content, :rows => 2, :cols => 24 %>
    </div>
    <div class="field">
      <%= f.select :comment_type, @comment.comment_types %>
    </div>
    <div class="actions">
      <%= f.submit 'Create' %>
    </div>
  <% end %>

  <% @screen.comments.all(:order => 'created_at DESC').each do |comment| %>
    <%= render 'comment', :comment => comment %>
  <% end %>
  
  <%= render 'fancy_button', :link => @screen.next_screen, :text => 'Next Screen' %>
</div>
